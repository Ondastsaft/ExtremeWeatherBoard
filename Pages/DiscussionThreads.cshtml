@page
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@model ExtremeWeatherBoard.Pages.DiscussionThreadsModel

@if (Model.DiscussionThreads != null)
{
    if (User.Identity != null)
    {
        @if (User.Identity.IsAuthenticated)
        {
            <div class=" row page-header w-100 mt-5">
                <a class="col-md-3 justify-content-end" asp-page="/PostDiscussionThread" asp-route-subCategoryId="@Model.SubCategoryId">Post Topic</a>
                <h1 class="col-md-9 d-flex justify-content-end">@Model.SubCategoryTitle</h1>
            </div>
        }

    }
    <div class="row d-flex justify-content-end flex-grow-1 my-4 w-100">
        @foreach (var discussionThread in Model.DiscussionThreads)
        {
            <div class="col-md-8 mb-5 mt-3">
                <div class="card d-flex">
                    <div class="card-header d-flex p-0 justify-content-end bg-success bg-opacity-25 "
                         style="height: 4em">
                        <div class="d-inline-flex" name="header content">
                            <img src="@discussionThread.ImageUrl"
                                 alt="Picture of user"
                                 class="object-fit-cover profile-image" />
                            <div class="d-flex flex-column justify-content-center align-items-end post-info">
                                <p class="h5 m-0">Post by @discussionThread.UserName</p>
                                <small class="fw-light">@discussionThread.TimeStamp</small>
                            </div>
                        </div>
                    </div>
                    <div class="card-title h6 mt-3 word-break text-end mb-0">
                        <p>@discussionThread.Title</p>
                    </div>
                    <div class="card-body my-0 py-0 text-truncate">
                        <p>
                            @discussionThread.Text
                        </p>
                    </div>
                    <div class="card-footer d-flex justify-content-end bg-success bg-opacity-10 ">
                        <div class="w-50 d-flex justify-content-end">
                            <form method="post" asp-page-handler="ReportTopic" asp-route-discussionThreadId="@discussionThread.Id"
                                  class="me-3" style="width: 8em;">
                                <input type="hidden" name="discussionThreadId" value="@discussionThread.Id" />
                                <button type="submit" class="btn btn-danger w-100" title="Report this post" aria-label="Report this post">
                                    Report
                                </button>
                            </form>
                            <a asp-page="/PostMessage" asp-route-recipentId="@discussionThread.UserDataId" class="btn btn-secondary me-3 " style="width: 8em;" title="Send message to user" aria-label="Send message to user">Message</a>
                            <a asp-page="User" asp-route-userDataId="@discussionThread.UserDataId" class="btn btn-secondary" style="width: 8em;" title="View user profile" aria-label="View user profile">User</a>
                        </div>
                    </div>
                </div>
            </div>

        }
    </div>
}




